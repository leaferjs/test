import { describe, expect, test } from 'vitest'

import { App, Group, Rect } from 'leafer-ui-node'


describe('Export', () => {


    const app = new App({ type: 'design', width: 100, height: 100 })
    const leafer = app.addLeafer()
    const group = new Group()
    const leaf = new Rect({ x: 10, y: 10, width: 20, height: 20, fill: 'gray' })

    group.add(leaf)
    leafer.add(group)

    app.start()


    test('toDataURL', async () => {
        const result = await app.export('png', { screenshot: true })
        expect(result.data).toBe('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkCAYAAABw4pVUAAAAAXNSR0IArs4c6QAAAARzQklUCAgICHwIZIgAAAB6SURBVHic7dExCoBQDAVB9eS5udZ2v1BccKYOvMBuGwAAANCxrx7OzPnk8Mwsb//J8fUD3AkSI0iMIDGCxAgSI0iMIDGCxAgSI0iMIDGCxAgSI0iMIDGCxAgSIwgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAvugCrSAQoJ5E5pwAAAABJRU5ErkJggg==')

        const result2 = await app.export('jpg', { screenshot: true, quality: 0.92 })
        expect(result2.data).toBe('data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/4gIoSUNDX1BST0ZJTEUAAQEAAAIYAAAAAAQwAABtbnRyUkdCIFhZWiAAAAAAAAAAAAAAAABhY3NwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAA9tYAAQAAAADTLQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAlkZXNjAAAA8AAAAHRyWFlaAAABZAAAABRnWFlaAAABeAAAABRiWFlaAAABjAAAABRyVFJDAAABoAAAAChnVFJDAAABoAAAAChiVFJDAAABoAAAACh3dHB0AAAByAAAABRjcHJ0AAAB3AAAADxtbHVjAAAAAAAAAAEAAAAMZW5VUwAAAFgAAAAcAHMAUgBHAEIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFhZWiAAAAAAAABvogAAOPUAAAOQWFlaIAAAAAAAAGKZAAC3hQAAGNpYWVogAAAAAAAAJKAAAA+EAAC2z3BhcmEAAAAAAAQAAAACZmYAAPKnAAANWQAAE9AAAApbAAAAAAAAAABYWVogAAAAAAAA9tYAAQAAAADTLW1sdWMAAAAAAAAAAQAAAAxlblVTAAAAIAAAABwARwBvAG8AZwBsAGUAIABJAG4AYwAuACAAMgAwADEANv/bAEMAAwICAgICAwICAgMDAwMEBgQEBAQECAYGBQYJCAoKCQgJCQoMDwwKCw4LCQkNEQ0ODxAQERAKDBITEhATDxAQEP/bAEMBAwMDBAMECAQECBALCQsQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEP/AABEIAGQAZAMBIgACEQEDEQH/xAAYAAEBAQEBAAAAAAAAAAAAAAAACAYHCf/EACoQAQAABQMBBgcAAAAAAAAAAAABAgMGBwQFFBIIERMhIkEYN1aEpbTT/8QAFAEBAAAAAAAAAAAAAAAAAAAAAP/EABQRAQAAAAAAAAAAAAAAAAAAAAD/2gAMAwEAAhEDEQA/APVMEgZ6z1liy8sb7bNs3Xw9t0fF8ChwdNU6OvTUp5vVPTjNHvmmmj5x9wV+IB+KPOv1z+M0f8m/wLnrLF6ZY2K2bmuvmbbrOV49Dg6an19Gmqzy+qSnCaHdNLLHyj7Ar8AAAAAAAAABAPaj+etzfZfp0V/JAz1gXLF6ZY325rZtTmbbrOL4Ffnaan19GmpSTemepCaHdNLNDzh7Amt1XsufPW2fvf06x8Lmdfob8no/6t/gXAuWLLyxsVzXNanD23R8rx6/O01To69NVkl9MlSM0e+aaWHlD3BX4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP//Z')

        app.fill = '#FF0000'
        app.renderer.render()
        const result3 = await app.export('png', { screenshot: true, })
        expect(result3.data).toBe('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkCAYAAABw4pVUAAAAAXNSR0IArs4c6QAAAARzQklUCAgICHwIZIgAAAEUSURBVHic7doxCoAwEADBKP5bfXms7SwEF5mpQy6wXJdljjEHGevXD+BOkBhBYgSJESRGkBhBYgSJESRme3rwPI5XB+8v3/cXNiRGkBhBYgSJESRGkBhBYgSJESRGkBhBYgSJESRGkBhBYgSJESRGkBhBYha/31tsSIwgMYLECBIjSIwgMYLECBIjSIwgMYLECBIjSIwgMYLECBIjSIwgMYLECBIjSIwgMYLECBIjSIwgMYLECBIjSIwgMYLECBIjSIwgMYLECBIjSIwgMYLECBIjSIwgMYLECBIjSIwgMYLECBIjSIwgMYLECBIjSIwgMYLECBIjSIwgMYLECBIjSIwgMYLECBIjSIwgMYLECBIjSMwFIkEHxb9zj8oAAAAASUVORK5CYII=')
    })


    test('saveAs', async () => {
        const result = await app.export('./dist/test-saveAs.jpg', { screenshot: true })
        expect(result.data).toBe(true)
    })


    test('toBlob', async () => {
        const result = await app.export('png', { blob: true, screenshot: true, })
        expect(result.data.length).toBe(362)
    })


})